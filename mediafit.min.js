/*	MediaFit
Copyright (C) 2018  Eric J. Winterstine
The JavaScript code in this page is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License (GNU GPL) as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.  The code is distributed WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
As additional permission under GNU GPL version 3 section 7, you may distribute non-source (e.g., minimized or compacted) forms of that code without the copy of the GNU GPL normally required by section 4, provided you include this license notice and a URL through which recipients can access the Corresponding Source.   */
if(void 0===mediafit)var mediafit={};function doMediaFit(){mediafit.doMediaFit()}mediafit=function(){var t,i,e,o,a,n,d,m=!1,c=[],r=[],s=[],l=[],u=!1,f={autoCheck:null,autoCheckInterval:null,checkOnScroll:null},h=function(e){for(var t in e)void 0!==f[t]?f[t]=e[t]:console.warn('mediaFit.js: Ignored unknown property named "'+t+'".')},p=function(){for(var e=document.getElementsByClassName("js-mediaFit"),t=0;t<e.length;t++)!1===T(e[t],"js-mediaFitCollected")&&g(e[t])},g=function(e){k(e,"js-mediaFitCollected");var t,i=e.tagName.toLowerCase(),o=e.getAttribute("data-position")||!1,a=e.getAttribute("src")||e.getAttribute("data-src")||!1,n=e.parentNode,d=e.getAttribute("data-containAt")||e.getAttribute("data-containat")||!1,m=e.getAttribute("data-flexContainer")||e.getAttribute("data-containerwrap")||!1,r=e.getAttribute("data-trigger")||!1;!1!==o&&o.match(/\d+%?\s\d+%?/)?((o=o.split(" "))[0]=isNaN(o[0].replace("%",""))?.5:parseInt(o[0].replace("%",""))/100,o[1]=isNaN(o[1].replace("%",""))?.5:parseInt(o[1].replace("%",""))/100):o=[.5,.5],!1!==d&&d.match(/\d+%?/)?d=!isNaN(d.replace("%",""))&&parseInt(d.replace("%",""))/100:mediaContainer=!1,!1!==m&&"true"==m.toLowerCase()&&(m=!0),e.getAttribute("data-lazyLoad")&&""!=e.getAttribute("data-lazyLoad")||e.getAttribute("data-lazyload")&&""!=e.getAttribute("data-lazyload")?(t=!0,a=e.getAttribute("data-lazyLoad")||e.getAttribute("data-lazyload")):t=!1,c.push({mediaType:i,loading:!1,loaded:!1,flexContainer:m,domObject:e,parentDom:n,domOffset:z(n).top,mediaObject:null,mediaSource:a,position:o,mediaContain:d,lazyLoad:t,trigger:r,error:!1})},w=function(){if(c.length<=0)return!1;for(var e,t=0;t<c.length;t++)e=c[t],!document.body.contains(e.domObject)||e.error?(c.splice(t,1),t-=1):!e.loading&&!e.loaded&&R(e.parentDom)&&x(e)&&"none"!==L(e.domObject,"display")?O(e):e.loaded&&(r.push(e),c.splice(t,1),t-=1)},b=function(){for(var e=0;e<c.length;e++)c[e].domOffset=z(c[e].parentDom).top},O=function(e){var t;e.loading=!0,k(e.parentDom,"loading"),k(e.domObject,"loading"),"img"===e.mediaType?((t=new Image).onerror=function(){console.warn("mediaFit: Cannot load "+this.src+".\nCheck the filepath and that it is absolute."),this.mediaFitItem.error=!0},t.onabort=function(){console.warn("mediaFit: Image load aborted for "+this.src+"."),this.mediaFitItem.error=!0},t.onload=function(){document.body.contains(this.mediaFitItem.domObject)?(this.mediaFitItem.domObject.setAttribute("src",this.src),j(this)):this.mediaFitItem.error=!0},t.queueAttempts=0,t.src=e.mediaSource,e.mediaObject=t):"video"===e.mediaType?(e.domObject.getAttribute("id")||(a++,e.domObject.setAttribute("id","js-mediaFitVideo"+a)),(t=document.getElementById(e.domObject.getAttribute("id"))).failed=0,t.onerror=function(){10<this.failed?(console.warn("mediaFit: Cannot load "+this.src+".\nCheck the filepath and that it is absolute."),this.mediaFitItem.error=!0):(0===this.failed&&s.push(this),setTimeout(function(){for(var e=0;e<s.length;e++)!1===s[e].mediaFitItem.loaded&&s[e].mediaFitItem.load()},500)),this.failed++},t.onabort=function(){10<this.failed?(console.warn("mediaFit: Video aborted "+this.src+".\nCheck the filepath and that it is absolute."),this.mediaFitItem.error=!0):(0===this.failed&&s.push(this),setTimeout(function(){for(var e=0;e<s.length;e++)!1===s[e].mediaFitItem.loaded&&s[e].mediaFitItem.load()},500)),this.failed++},t.onloadeddata=function(){if(document.body.contains(this.mediaFitItem.domObject)){var e=document.createElement("source");e.src=this.src,e.type="video/mp4",this.mediaFitItem.domObject.appendChild(e),j(this)}else this.mediaFitItem.error=!0},t.queueAttempts=0,t.src=e.mediaSource,t.load(),e.mediaObject=t):"iframe"===e.mediaType&&((t={}).src=e.mediaSource,e.domObject.src=e.mediaSource,(e.mediaObject=t).mediaFitItem=e,t.queueAttempts=0,j(t)),t.mediaFitItem=e},j=function(e){y(e.mediaFitItem),e.mediaFitItem.queue&&e.queueAttempts<12?(e.queueAttempts++,l.push(e),!1===u&&(u=!0,setTimeout(function(){for(;l.length;)j(l.shift());u=!1},400))):12<=e.queueAttempts?(console.warn("mediaFit.js: Could not get width/height dimensions of mediaFit object."),console.log("Image source: "+e.mediaFitItem.mediaSource),console.log("Virtual Natural Width: "+e.mediaFitItem.mediaObject.naturalWidth),console.log("Virtual Width: "+e.mediaFitItem.mediaObject.width),console.log("DOM Natural Width: "+e.mediaFitItem.domObject.naturalWidth),console.log("DOM Width: "+e.mediaFitItem.domObject.width),console.log("-----------------------------------------------")):F(e)},F=function(e){if(e.mediaFitItem.loaded=!0,e.mediaFitItem.loading=!1,S(e.mediaFitItem.parentDom,"loading"),S(e.mediaFitItem.domObject,"loading"),k(e.mediaFitItem.parentDom,"loaded"),k(e.mediaFitItem.domObject,"loaded"),!1!==e.mediaFitItem.trigger)for(var t=e.mediaFitItem.trigger.split(","),i=0;i<t.length;i++)k(document.getElementById(t[i]),"loaded")},y=function(e){if(e.domObject.setAttribute("style",""),"static"===L(e.parentDom,"position")||!R(e.parentDom)||"none"===L(e.domObject,"display"))return!1;e.domObject.style.display="block",e.domObject.style.position="absolute";var t=e.mediaObject.naturalWidth||e.mediaObject.width||e.domObject.naturalWidth||e.domObject.width||e.domObject.videoWidth||e.domObject.offsetWidth,i=e.mediaObject.naturalHeight||e.mediaObject.height||e.domObject.naturalHeight||e.domObject.height||e.domObject.videoHeight||e.domObject.offsetHeight,o=t/i;if(void 0===t||void 0===i||isNaN(t)||isNaN(i)||t<=2||i<=2)return!(e.queue=!0);e.queue=!1,1<=o?(k(e.domObject,"landscape-media"),k(e.parentDom,"landscape-media"),S(e.domObject,"portrait-media"),S(e.parentDom,"portrait-media")):(k(e.domObject,"portrait-media"),k(e.parentDom,"portrait-media"),S(e.domObject,"landscape-media"),S(e.parentDom,"landscape-media")),o=(t=e.mediaObject.naturalWidth||e.mediaObject.width||e.domObject.naturalWidth||e.domObject.width||e.domObject.videoWidth||e.domObject.offsetWidth)/(i=e.mediaObject.naturalHeight||e.mediaObject.height||e.domObject.naturalHeight||e.domObject.height||e.domObject.videoHeight||e.domObject.offsetHeight);var a,n,d,m,r=e.parentDom.offsetWidth,c=e.parentDom.offsetHeight,s=r/c;if("iframe"===e.mediaType&&!1!==e.mediaContain||"iframe"===e.mediaType&&e.flexContainer)i=t/(o=1.77777778);else if("iframe"==e.mediaType)return e.domObject.style.width=Math.ceil(r+1)+"px",e.domObject.style.height=Math.ceil(c+1)+"px",e.domObject.style.left="0px",e.domObject.style.top="0px",!0;if(e.flexContainer&&(e.parentDom.setAttribute("style",""),0!==parseFloat(L(e.parentDom,"height"))?(s=(r=c*o)/c,e.parentDom.style.width=r+"px"):(s=r/(c=r/o),e.parentDom.style.height=c+"px")),s<o){var l=1-s/o;!1!==e.mediaContain&&l>=e.mediaContain?(d=0,m=(c-(n=(a=r)/o))*e.position[1]):(d=(r-(a=(n=c)*o))*e.position[0],m=0)}else{l=1-o/s;!1!==e.mediaContain&&l>=e.mediaContain?(d=(r-(a=(n=c)*o))*e.position[0],m=0):(d=0,m=(c-(n=(a=r)/o))*e.position[1])}e.domObject.style.width=Math.ceil(a+1)+"px",e.domObject.style.height=Math.ceil(n+1)+"px",e.domObject.style.left=Math.floor(d)+"px",e.domObject.style.top=Math.floor(m)+"px"},I=function(){window.onscroll=function(){f.checkOnScroll&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){A()}):window.msRequestAnimationFrame?window.msRequestAnimationFrame(function(){A()}):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(function(){A()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){A()}):window.oRequestAnimationFrame&&window.oRequestAnimationFrame(function(){A()})),"function"==typeof o&&o()},window.addEventListener("resize",function(){clearTimeout(e),e=setTimeout(function(){v()},150)})},A=function(){t=window.pageYOffset,p(),b(),w()},v=function(e){e=void 0===e||e,t=window.pageYOffset,i=window.innerHeight,b(),w(),N()},C=function(){n=D(),n-d>f.autoCheckInterval&&(d=n,t=window.pageYOffset,p(),b(),w()),f.autoCheck&&q()},q=function(){window.requestAnimationFrame?window.requestAnimationFrame(C):window.msRequestAnimationFrame?window.msRequestAnimationFrame(C):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(C):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(C):window.oRequestAnimationFrame?window.oRequestAnimationFrame(C):void 0===window.requestNextFrame&&(window.requestNextFrame=setInterval(function(){C()},18))},D=function(){return parseInt((new Date).getTime())},N=function(){for(var e=0;e<r.length;e++)y(r[e])},R=function(e){return 0<e.offsetWidth&&0<e.offsetHeight},x=function(e){return!1!==e.lazyLoad&&t+i>e.domOffset-350&&t<=e.domOffset+e.parentDom.offsetHeight+350||!1===e.lazyLoad},k=function(e,t){S(e,t),e.className=e.className.replace(/^\s\s*/g,"").replace(/\s\s*$/g,"").replace(/\s\s+/g," ")+" "+t},S=function(e,t){e.className=e.className.replace(new RegExp(t,"g"),"").replace(/^\s\s*/g,"").replace(/\s\s*$/g,"").replace(/\s\s+/g," ")},T=function(e,t){for(var i=e.className.replace(/^\s\s*/g,"").replace(/\s\s*$/g,"").replace(/\s\s+/g," ").split(" "),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1},z=function(e){var t={top:0,left:0};return void 0!==e.getBoundingClientRect&&(t=e.getBoundingClientRect()),{top:t.top+(window.pageYOffset||e.scrollTop)-(e.clientTop||0),left:t.left+(window.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}},L=function(e,t){var i,o,a,n,d=(e.ownerDocument||document).defaultView;return d&&d.getComputedStyle?(t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),d.getComputedStyle(e,null).getPropertyValue(t)):e.currentStyle?(t=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),i=e.currentStyle[t],/^\d+(em|pt|%|ex)?$/i.test(i)?(o=i,a=e.style.left,n=e.runtimeStyle.left,e.runtimeStyle.left=e.currentStyle.left,e.style.left=o||0,o=e.style.pixelLeft+"px",e.style.left=a,e.runtimeStyle.left=n,o):i):void 0};return{init:function(e){e=void 0!==e&&e,m||(t=window.pageYOffset,i=window.innerHeight,document.getElementsByTagName("body")[0],window.onresize,o=window.onscroll,a=0,d=D()),f={autoCheck:!0,autoCheckInterval:300,checkOnScroll:!1},e&&h(e),m||(p(),I(),w()),f.autoCheck&&C(),m=!0},checkUnloadedMediaFits:w,doMediaFit:function(){p(),w(),N()},isInitialized:function(){return m}}}(),function(e,t){e=e||"docReady",t=t||window;var i=[],o=!1,a=!1;function n(){if(!o){o=!0;for(var e=0;e<i.length;e++)i[e].fn.call(window,i[e].ctx);i=[]}}function d(){"complete"===document.readyState&&n()}t[e]=function(e,t){if("function"!=typeof e)throw new TypeError("callback for docReady(fn) must be a function");o?setTimeout(function(){e(t)},1):(i.push({fn:e,ctx:t}),"complete"===document.readyState?setTimeout(n,1):a||(document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):(document.attachEvent("onreadystatechange",d),window.attachEvent("onload",n)),a=!0))}}("docIsReady",window),docIsReady(function(){0==mediafit.isInitialized()&&mediafit.init()});